package me.primooctopus33.octohack.client.modules.exploit;

import java.util.Comparator;
import me.primooctopus33.octohack.client.modules.Module;
import net.minecraft.client.gui.inventory.GuiScreenHorseInventory;
import net.minecraft.entity.Entity;
import net.minecraft.entity.passive.AbstractChestHorse;
import net.minecraft.network.play.client.CPacketUseEntity;
import net.minecraft.util.EnumHand;

public class ManualIllegalStack
extends Module {
    private boolean noBypass;

    public ManualIllegalStack() {
        super("ManualIllegalStack", "Right clicks the donkey chest to perform the Illegal Stack/Salc1 Dupe", Module.Category.EXPLOIT, true, false, false);
    }

    @Override
    public void onEnable() {
        AbstractChestHorse abstractChestHorse;
        super.onEnable();
        Entity l_Entity = ManualIllegalStack.mc.world.loadedEntityList.stream().filter(p_Entity -> this.isValidEntity((Entity)p_Entity)).min(Comparator.comparing(p_Entity -> Float.valueOf(ManualIllegalStack.mc.player.getDistance((Entity)p_Entity)))).orElse(null);
        if (ManualIllegalStack.mc.currentScreen instanceof GuiScreenHorseInventory && l_Entity instanceof AbstractChestHorse && ManualIllegalStack.mc.player.getRidingEntity() != null && (abstractChestHorse = (AbstractChestHorse)((Object)l_Entity)).hasChest()) {
            this.noBypass = true;
            ManualIllegalStack.mc.player.connection.sendPacket(new CPacketUseEntity(l_Entity, EnumHand.MAIN_HAND, l_Entity.getPositionVector()));
            this.noBypass = false;
            this.toggle();
        }
    }

    private boolean isValidEntity(Entity entity) {
        AbstractChestHorse l_AbstractChestHorse;
        return entity instanceof AbstractChestHorse && !(l_AbstractChestHorse = (AbstractChestHorse)((Object)entity)).isChild() && l_AbstractChestHorse.func_110248_bS();
    }

    public boolean ignoreMountBypass() {
        return this.noBypass;
    }
}
